#include "kernel.h"
#include "memory.h"
#include "process.h"
#include "scheduler.h"
#include "syscall.h"
#include "io.h"

// Главная функция ядра
void kernel_main(void) {
    // Инициализация видеорежима и вывода на экран
    init_video();

    // Вывод приветственного сообщения
    print("Добро пожаловать в BoyJack OS!\n");

    // Инициализация системы памяти
    init_memory();

    // Инициализация системных вызовов
    init_syscalls();

    // Инициализация процессора
    init_processor();

    // Инициализация планировщика процессов
    init_scheduler();

    // Запуск первого процесса
    start_first_process();

    // Основной цикл ядра
    while (1) {
        // Обработка системных событий
        handle_events();
        
        // Выполнение планировщика
        schedule();
    }
}

// Инициализация видеорежима
void init_video(void) {
    // Код для инициализации видеорежима (например, для вывода текста на экран)
    // Обычно это низкоуровневый код для работы с графическим или текстовым режимом
}

// Функция для вывода текста на экран
void print(const char *str) {
    // Простой вывод на экран
    while (*str) {
        // Печать каждого символа (это может быть низкоуровневый вывод)
        put_char(*str++);
    }
}

// Инициализация памяти
void init_memory(void) {
    // Инициализация менеджера памяти
    // Включает настройку heap, stack и другие ресурсы памяти
    memory_init();
}

// Инициализация системных вызовов
void init_syscalls(void) {
    // Установка системных вызовов для работы с процессами, файлами и прочим
    setup_syscalls();
}

// Инициализация процессора
void init_processor(void) {
    // Настройка процессора, например, конфигурация прерываний
    setup_processor();
}

// Инициализация планировщика
void init_scheduler(void) {
    // Настройка планировщика процессов
    setup_scheduler();
}

// Запуск первого процесса (например, init)
void start_first_process(void) {
    // Запуск базового процесса, например, процесса инициализации
    create_process("init", init_process);
}

// Основной цикл обработки событий
void handle_events(void) {
    // Здесь может быть обработка различных событий, например, ввод с клавиатуры,
    // прерывания и другие низкоуровневые события
}

// Планировщик процессов
void schedule(void) {
    // Запуск планировщика, который выбирает процесс для выполнения
    // и переключает контекст между процессами
    switch_process();
}
